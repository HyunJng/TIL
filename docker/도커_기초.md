# Docker 기초
## 목차
* [1. 도커 학습 전 기초지식](#1-도커-학습-전-기초지식)
    + [1.1. 컨테이너형 가상화](#11-컨테이너형-가상화)
    + [1.2. 컨테이너의 장점](#12-컨테이너의-장점)
* [2. Docker 개념](#2-Docker-개념)
    + [2.1. 도커란?](#21-도커란?)
    + [2.2. 도커를 왜 사용?](#22-도커를-왜-사용)
    + [2.3. 도커컴포즈란?](#23-도커컴포즈란)
    + [2.4. 쿠버네티스란?](#24-쿠버네티스란)
    + [2.5. 컨테이너 이미지란?](#25-컨테이너-이미지란)
* [3. 도커 이미지](#3-도커-이미지)
    + [3.1. 이미지 생성하는 Dockerfile 문법](#31-이미지-생성하는-Dockerfile-문법)
    + [3.2. 이미지 관련 명령어](#32-이미지-관련-명령어)
        - [3.2.1. 이미지 빌드 명령어](#321-이미지-빌드-명령어)
        - [3.2.2. 이미지 가져오기 명령어](#322-이미지-가져오기-명령어)
        - [3.2.3. 이미지 목록 확인 명령어](#323-이미지-목록-확인-명령어)
        - [3.2.4. 이미지 태그 지정](#324-이미지-태그-지정)

## 1. 도커 학습 전 기초지식
### 1.1. 컨테이너형 가상화
![docker_basic_1.png](/docker/images/docker_basic_1.png)
- **컨테이너**
    - 호스트 OS에서 파일 시스템을 나누고 
새로운 파일 시스템과 애플리케이션으로 구성된 별도의 공간

![docker_basic_2.png](/docker/images%2Fdocker_basic_2.png)
- 컨테이너 가상화 기술
    - OS커널은 호스트껄 사용하고, 단순히 파일 시스템을 분리하는거라 빠른 시작과 종료가 가능하다

> **호스트 OS형 가상화** 
>
> 가상화처럼 OS에 설치한 가상화 소프트웨어로 하드웨어를 구현해 게스트 OS를 만드는 것 

### 1.2. 컨테이너의 장점
- 기존 가상 머신에 비해 성능 오버헤드가 적음 
- 빠르고 쉬운 애플리케이션 배포 
- 이미지 버젼 관리과 쉬움 
- 각 컨테이너 사이에 독립적인 동작 환경 제공

---

## 2. Docker 개념
### 2.1. 도커란?
![docker_basic_3.png](/docker/images%2Fdocker_basic_3.png)
컨테이너 가상화 도구로 세 개의 구성으로 되어있다
- Docker Server : 컨테이너 가상화 기술 구현한 기본 애플리케이션
- Docker Rest API: 도커 서버를 조작하기 위한 인터페이스
- Docker CLI: 도커 커맨드 라인 애플리케이션으로, 도커 REST API와 통신하여 대화식으로 도커 서버를 조작할 수 있다

### 2.2. 도커를 왜 사용?
`애플리케이션 + 파일시스템(OS환경 + 미들웨어)`를 한꺼번에 패키징으로 배포할 수 있기 때문에 
이식성이 높고, 환경을 코드로 관리할 수 있어 공유가 편함

### 2.3. 도커컴포즈란?
- yml형식의 설정 파일에 실행할 컨테이너를 정의하거나 의존관계를 정의하여 동작 순서를 제어하는 컨테이너 오케스트레이션 시스템이다.
- 애플리케이션 미들웨어의 의존성을 코드로 간단히 구현할 수 있다.

### 2.4. 쿠버네티스란?
- 여러 컨테이너를 한꺼번에 관리할 수 있게 해주는 컨테이너 오케스트레이션 시스템이다.

### 2.5. 컨테이너 이미지란?
- **컨테이너**: 컨테이너 이미지 기반으로 구성된, 파일 시스템과 애플리케이션이 실행된 상태
- **컨테이너 이미지**: 컨테이너를 구성하는 파일 시스템과 실행 애플리케이션 설정을 모은 템플릿

---
## 3. 도커 이미지
### 3.1. 이미지 생성하는 Dockerfile 문법
> Dockerfile
>    - 도커가 어떤 이미지를 생성하고 실행할지를 정의하는 파일 
>    - Dockerfile 에서 사용하는 키워드를 인스트럭션(instruction) 이라고 한다

**예시**
```shell
FROM golang:1.20.5

WORKDIR /go/src/github.com/HyunJng/echo
COPY main.go .
RUN go mod init

CMD ["go", "run", "main.go"]
```
#### `FROM`
컨텡이너 기본 이미지 지정. 이미지 빌드할 때 먼저 `FROM`으로 지정한 이미지 다운하고 실행

#### `WORKDIR`
컨테이너 내 현재 디렉토리 지정. 지정된 경로가 없으면 새로 만듬

#### `COPY`
```shell
COPY [from(호스트 파일 경로)] [to(컨테이너 파일 경로)]
```
호스트에서 컨테이너 내로 복사할 파일 지정

#### `RUN`
이미지를 빌드할 때 컨테이너에서 실행하는 커맨드 정의. 보통 도구의 설치나 애플리케이션의 빌드 처리를 기술함

#### `CMD`
```shell
## go run main.go 실행
CMD ["go", "run", "main.go"]
```
컨테이너를 실행할 때 컨테이너에서 실행할 프로세스를 지정. `RUN`과 달리 `CMD`는 컨테이너 시작 시 한번 실행된다. 보통 CMD로 애플리케이션 자체를 동작시킨다.

#### `ENV`
도커 컨테이너에서 사용할 수 있는 환경변수를 지정

#### `ARG`
이미지 빌드시에만 사용할 수 있는 임시변수

### 3.2. 이미지 관련 명령어
#### 3.2.1. 이미지 빌드 명령어
```shell
docker image build -t 이미지명[:태그명] Dockerfile의_디렉토리_경로
```
- 이미지명은 네임스페이스를 지정해주는 것을 추천
- 태그를 지정하지 않으면 기본적으로 `:latest`가 된다.(기존건 none)
- 기본적으로 `Dockerfile`이름의 파일을 찾는다(확장자 없음)

```shell
## -f 파일이름: Dockerfile 이름 외의 도커파일을 사용하고 싶을 때 
docker image build -f Dockerfile-test -t test/dockerImage:latest . 

## --pull: 도커기본이미지를 저장해둔걸 사용하지 않고 새로 가져옴
docker image build --pull=true -t test/dockerImage:latest . 
```

#### 3.2.2. 이미지 가져오기 명령어
```shell
docker image pull [option] 리포지터리명[:태그명]
docker image pull nginx:latest
```
- 가져온 이미지는 그대로 컨테이너로 사용할 수 있다 

#### 3.2.3. 이미지 목록 확인 명령어
```shell
docker image ls
```

#### 3.2.4. 이미지 태그 지정
```shell
docker image tag 기존이미지명[:태그] 새이미지명[:태그]
docker image tag test/dockerImage:latest test/dockerImage:1.0.0
```
