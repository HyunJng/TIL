# item 49. 매개변수가 유효한지 검사하라

## 1. 개요

* 메서드나 생성자에서는 **입력 매개변수가 유효한지 반드시 검사해야 한다**.
* 잘못된 인수를 조기에 확인할수록 디버깅이 쉽고, 오류가 내부 로직까지 퍼지는 것을 방지할 수 있다.
* 단, **유효성 검사 필요성과 API의 범용성은 별개의 문제**라는 점을 반드시 구분해야 한다.

---

## 2. 왜 메서두 앞단에서 검사해야 하는가

1. **Fail Fast 원칙 적용**

    * 잘못된 입력이 들어오면 즉시 예외를 던져야 한다.
    * 문제를 초기에 노출하기 때문에 버그 추적이 용이하다.

2. **내부 상태 손상 방지**

    * 잘못된 값이 메서드 내부로 들어가면 더 큰 오류를 발생시킬 수 있다.

3. **명확한 예외 원인 제공**

    * 어디서 잘못되었는지 정확히 알려주기 때문에 API 사용성이 개선된다.

예:

```java
public void setAge(int age) {
    if (age < 0) {
        throw new IllegalArgumentException("age must be >= 0");
    }
    this.age = age;
}
```

---

## 3. 표준적인 검사 방법

### 3.1. `Objects.requireNonNull()`

* 널 검사가 필요한 대부분의 경우에 사용.

```java
this.name = Objects.requireNonNull(name, "name is null");
```

### 3.2. 특정 범위 검사

```java
if (index < 0 || index >= size) {
    throw new IndexOutOfBoundsException(...);
}
```

### 3.3. Assertion을 통한 내부 검증(디버깅 조건)

* 외부에서 넘어오는 값이 아니라, **메서드가 자신 내부에서 생성한 값**에 대해서는 assert를 활용할 수 있다.

```java
assert elements != null;
```

---

## 4. 단, “매개변수에 제약을 두라는 의미”로 해석하면 안 된다

### 4.1. 책에서 말하는 경고의 의미

* “유효성 검사하라”는 말은 **제약을 빡빡하게 만들어라**가 아니라,
* “정해진 제약 범위 내에서 들어온 입력이 잘못되었는지 빨리 검증하라”는 뜻이다.

### 4.2. API는 최대한 범용적이어야 한다

* 매개변수에 **불필요한 제약을 추가하지 말아야 한다**.
* 가능한 한 *넓은 입력을 허용하는 형태로* 메서드를 설계해야 한다.

예: 

나쁜 API
```java
// 배열 길이가 반드시 10이어야만 한다.
public int sum(int[] arr) { ... }
```

좋은 API

```java
public int sum(int[] arr) { ... } // 길이가 0~N 모두 허용
```

### 4.3. “검사해야 한다”와 “제약을 늘리지 않는다”는 상충하지 않는다

* 유효성 검사 = 잘못된 값을 걸러내는 **구현상의 안전장치**
* 범용성 = 입력 범위를 좁히지 않는 **설계상의 목표**

→ 둘은 층위가 다르며 서로 보완적이다.

---

## 5. 성능을 위해 유효성 검사를 생략해도 되는 경우

* **private 메서드**나
* **성능이 절대적으로 중요하며 호출 규약이 확실한 곳**에서는
  유효성 검사를 생략할 수 있다.

예:

* Collections 내부 구현, Arrays.sort 등

그러나 public API에서는 반드시 검사해야 한다.

---

## 6. 예외 메시지를 신중하게 작성할 것

* 잘못된 값이 무엇인지, 기대하는 값은 무엇인지 명확히 알려야 한다.

좋은 예:

```
IllegalArgumentException: threshold must be >= 0 (was -5)
```